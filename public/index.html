<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poolify - Login</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCAy95nwYF-LyIS_DmAwYcK1vTjV9YcX1w",
            authDomain: "poolify-95b73.firebaseapp.com",
            projectId: "poolify-95b73",
            storageBucket: "poolify-95b73.firebasestorage.app",
            messagingSenderId: "844374109699",
            appId: "1:844374109699:web:0ef99fe2d365878432b902",
            measurementId: "G-7L8Q8JDS4X"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
    </script>
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Logo Section -->
            <div class="logo-section">
                <i class="fas fa-swimming-pool fa-3x" style="color: var(--primary);"></i>
                <h1>Poolify</h1>
                <p>Order Together, Save Together</p>
            </div>
            
            <!-- Login Form -->
            <div class="auth-form">
                <h2>Login to Your Account</h2>
                
                <div class="form-group">
                    <label for="loginEmail">
                        <i class="fas fa-envelope"></i> Email Address
                    </label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">
                        <i class="fas fa-lock"></i> Password
                    </label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    <span class="toggle-password" onclick="togglePassword('loginPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <button class="btn-primary btn-block" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="auth-links">
                    <p>Don't have an account? <a href="#" onclick="showRegister()">Sign Up</a></p>
                    <p><a href="#" onclick="resetPassword()">Forgot Password?</a></p>
                </div>
                
                <!-- Demo Login Button -->
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn-secondary" onclick="demoLogin()" 
                            style="background: #25D366; color: white;">
                        <i class="fas fa-bolt"></i> Quick Demo Login
                    </button>
                    <p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                        Use for testing: test@poolify.com / 123456
                    </p>
                </div>
            </div>
            
            <!-- Register Form (Hidden by default) -->
            <div class="auth-form" id="registerForm" style="display: none;">
                <h2>Create New Account</h2>
                
                <div class="form-group">
                    <label for="registerName">
                        <i class="fas fa-user"></i> Full Name
                    </label>
                    <input type="text" id="registerName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">
                        <i class="fas fa-envelope"></i> Email Address
                    </label>
                    <input type="email" id="registerEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">
                        <i class="fas fa-lock"></i> Password
                    </label>
                    <input type="password" id="registerPassword" placeholder="Create password (min 6 chars)" required>
                    <span class="toggle-password" onclick="togglePassword('registerPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <div class="form-group">
                    <label for="registerHostel">
                        <i class="fas fa-home"></i> Hostel Name
                    </label>
                    <input type="text" id="registerHostel" placeholder="e.g., Hostel A, Block B" required>
                </div>
                
                <button class="btn-primary btn-block" onclick="register()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <div class="auth-links">
                    <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
                </div>
            </div>
        </div>
        
        <!-- Features Section -->
        <div class="features-section">
            <h3><i class="fas fa-star"></i> Why Poolify?</h3>
            <div class="features-grid">
                <div class="feature">
                    <i class="fas fa-money-bill-wave"></i>
                    <h4>Save Money</h4>
                    <p>Split delivery fees with neighbors</p>
                </div>
                <div class="feature">
                    <i class="fas fa-users"></i>
                    <h4>Group Orders</h4>
                    <p>Create or join pools instantly</p>
                </div>
                <div class="feature">
                    <i class="fas fa-bolt"></i>
                    <h4>Fast Delivery</h4>
                    <p>From Blinkit, Zepto, Instamart</p>
                </div>
                <div class="feature">
                    <i class="fas fa-comments"></i>
                    <h4>Live Chat</h4>
                    <p>Coordinate with pool members</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle Password Visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        // Show Register Form
        function showRegister() {
            document.querySelector('.auth-form').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }
        
        // Show Login Form
        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.querySelector('.auth-form').style.display = 'block';
        }
        
        // Login Function
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            console.log("Attempting login with:", email);
            
            // Show loading
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            btn.disabled = true;
            
            // Firebase Login
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Login successful:", user.email);
                    
                    // IMPORTANT: Save user data to localStorage
                    localStorage.setItem('poolify_user', JSON.stringify({
                        email: user.email,
                        uid: user.uid,
                        name: user.displayName || user.email.split('@')[0],
                        timestamp: Date.now()
                    }));
                    
                    // Also save to sessionStorage as backup
                    sessionStorage.setItem('poolify_user', JSON.stringify({
                        email: user.email,
                        uid: user.uid
                    }));
                    
                    // Redirect to dashboard
                    setTimeout(() => {
                        window.location.href = "dashboard.html";
                    }, 500);
                    
                })
                .catch((error) => {
                    console.error("Login error:", error);
                    
                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    
                    // Show error message
                    let errorMessage = "Login failed. ";
                    
                    switch(error.code) {
                        case 'auth/user-not-found':
                            errorMessage += "No account found with this email.";
                            break;
                        case 'auth/wrong-password':
                            errorMessage += "Incorrect password.";
                            break;
                        case 'auth/invalid-email':
                            errorMessage += "Invalid email format.";
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    alert(errorMessage);
                });
        }
        
        // Demo Login (Quick test)
        function demoLogin() {
            document.getElementById('loginEmail').value = 'test@poolify.com';
            document.getElementById('loginPassword').value = '123456';
            login();
        }
        
        // Register Function
        function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const hostel = document.getElementById('registerHostel').value.trim();
            
            if (!name || !email || !password || !hostel) {
                alert('Please fill all fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            // Show loading
            const btn = document.querySelector('#registerForm .btn-primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
            btn.disabled = true;
            
            // Firebase Registration
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Update profile
                    return user.updateProfile({
                        displayName: name
                    }).then(() => {
                        // Save user data
                        localStorage.setItem('poolify_user', JSON.stringify({
                            email: user.email,
                            uid: user.uid,
                            name: name,
                            hostel: hostel,
                            timestamp: Date.now()
                        }));
                        
                        alert('Account created successfully!');
                        
                        // Redirect to dashboard
                        setTimeout(() => {
                            window.location.href = "dashboard.html";
                        }, 1000);
                    });
                })
                .catch((error) => {
                    console.error("Registration error:", error);
                    
                    // Reset button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    
                    // Show error
                    alert("Registration failed: " + error.message);
                });
        }
        
        // Reset Password
        function resetPassword() {
            const email = prompt("Enter your email to reset password:");
            if (email) {
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        alert('Password reset email sent! Check your inbox.');
                    })
                    .catch((error) => {
                        alert('Error: ' + error.message);
                    });
            }
        }
        
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('poolify_user');
            if (savedUser) {
                console.log("User already logged in, redirecting...");
                // Optional: Auto-redirect if already logged in
                // window.location.href = "dashboard.html";
            }
        });
    </script>
</body>
</html>
